!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.kbyte={})}(this,function(e){"use strict";let t;t="undefined"!=typeof window?window.WebSocket:require("ws");const s=(e,t)=>{setTimeout(()=>{1===e.readyState?null!==t&&t():s(e,t)},5)};class i{constructor(e){this.address=e,this.open=!1,this.queue={},this.notifications=(()=>{}),this.ws=new t(e),this.ws.addEventListener("message",e=>{const t=JSON.parse(e.data);this.queue[t[1].tag]?this.queue[t[1].tag](null,t[1].response):this.notifications(null,t)}),this.ws.addEventListener("open",()=>{this.open=!0}),this.ws.addEventListener("close",()=>{this.open=!1})}subscribe(e){this.notifications=e}send(e,t,i){const n={command:e};t&&(n.params=t),n.tag=Math.random().toString(36).substring(7),this.queue[n.tag]=i;const o=JSON.stringify(["request",n]);s(this.ws,()=>{this.ws.send(o)})}}e.Client=i,Object.defineProperty(e,"__esModule",{value:!0})});
