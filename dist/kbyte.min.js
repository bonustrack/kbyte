!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.kbyte={})}(this,function(e){"use strict";let t;t="undefined"!=typeof window?window.WebSocket:require("ws");const s=(e,t)=>{setTimeout(()=>{1===e.readyState?null!==t&&t():s(e,t)},5)};e.Client=class{constructor(e){this.address=e,this.open=!1,this.queue={},this.notifications=(()=>{}),this.ws=new t(e),this.ws.addEventListener("message",e=>{const t=JSON.parse(e.data);if(this.queue[t[1].tag]){const e=t[1].response.error||null,s=e?null:t[1].response;this.queue[t[1].tag](e,s)}else this.notifications(null,t)}),this.ws.addEventListener("open",()=>{this.open=!0}),this.ws.addEventListener("close",()=>{this.open=!1})}subscribe(e){this.notifications=e}send(e){s(this.ws,()=>{this.ws.send(JSON.stringify(e))})}request(e,t,s){const n={command:e};t&&(n.params=t),n.tag=Math.random().toString(36).substring(7),this.queue[n.tag]=s,this.send(["request",n])}justsaying(e,t){const s={subject:e};t&&(s.body=t),this.send(["justsaying",s])}},Object.defineProperty(e,"__esModule",{value:!0})});
